<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.hiddenlayer.dalabel.dolabeling.DataDoLabelingMapper">
	<insert id="addLabelData"
		parameterType="com.hiddenlayer.dalabel.dolabeling.LabelData">
		<![CDATA[
			insert into Labeling_Done
			values (#{project_no}, #{data_no}, #{worked_by}, #{label})
		]]>
	</insert>
	<insert id="addLabelDoList"
		parameterType="com.hiddenlayer.dalabel.dolabeling.LabelDoList">
		<![CDATA[
			insert into Labeling_Do
			values (#{dolabel_user}, #{dolable_project_no}, #{dolabel_state}, #{dolabel_score})
		]]>
	</insert>
	<select id="findLabelDoList"
		resultType="com.hiddenlayer.dalabel.dolabeling.LabelDoList">
		<![CDATA[
			select dolabel_user, dolabel_project_no, dolabel_state, dolabel_score from
				(select dolabel_user, dolabel_project_no, dolabel_state, dolabel_score, rownum as rn 
				from Labeling_Do
				where dolabel_user=#{userid} and dolabel_state <> 2)
			where rn>=#{start} and rn<=#{end}
		]]>
	</select>
	<select id="findAccessableDoList"
		resultType="com.hiddenlayer.dalabel.dolabeling.SearchResultDoLabelingList">
		<![CDATA[
			select a.project_no as project_no, a.project_title as project_title, a.project_requestor as project_requestor, a.project_how as project_how, b.dolabel_state as dolabel_state from
				(
				select project_no, project_title, project_requestor, project_how
				from Labeling_project
				where project_no<#{projectstart} and (
					(project_access_level is not null) and( 
        				(project_access_level>=16 and bitand(bitor(userlevel,8), project_access_level) = project_access_level-16 )
            		or(project_access_level<16
            			and bitand(bitor(userlevel,8), project_access_level) > 0)))
				) as a
			left join (select * from Labeling_Do where dolabel_user=#{userid}) as b
			on a.project_no = b.dolabel_project_no
			where rn<=#{getnum}
		]]>
	</select>
	<select id="getJoinProjectCount" resultType="java.lang.Integer">
		<![CDATA[
			select count(*) from Labeling_Do
			where dolabel_user=#{userid}
		]]>
	</select>
	<update id="updateLabelState"
		parameterType="com.hiddenlayer.dalabel.dolabeling.LabelDoList">
		<![CDATA[
			update Labeling_Do
			set dolabel_state=#{dolabel_state}
			where dolabel_user=#{dolabel_user} and dolable_project_no=#{dolable_project_no}
		]]>
	</update>
</mapper>