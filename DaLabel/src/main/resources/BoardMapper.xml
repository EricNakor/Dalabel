<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hiddenlayer.dalabel.board.BoardMapper">
	<!-- 게시글 검색 -->
	<select id="getPost"
		resultType="com.hiddenlayer.dalabel.board.Board"
		parameterType="com.hiddenlayer.dalabel.board.BoardSelector">	
		<![CDATA[
		select board_writer, board_id, board_category, board_title,  board_regist
		from(
			select * from (
				select rownum as rn, board_id, board_category, board_writer, board_title, board_regist
				from (
					select * 
					from board
					where board_writer like '%'||#{search}||'%' or board_title like '%'||#{search}||'%'
					order by board_regist desc
				)
			)
			where rn >= #{start} and rn <= #{end}
		),(
		select user_id
		from member
		where user_id in (
			select board_writer
			from (
				select rownum as rn, board_id, board_writer, board_title, board_regist
				from (
					select*
					from board
					where board_writer like '%'||#{search}||'%' or board_title like '%'||#{search}||'%'
					order by board_regist desc
					)
				)
				where rn >= #{start} and rn <= #{end}
			)
	)
		]]>

	</select>

	<select id="getDetailBoard" parameterType="java.lang.Integer"
	resultType="com.hiddenlayer.dalabel.board.Board">
		<![CDATA[
		select * from board
		where board_id = #{board_id}
		]]>
	</select>

	<!-- 게시글 카운트 -->
	<select id="getPostCount"
		parameterType="com.hiddenlayer.dalabel.board.BoardSelector"
		resultType="java.lang.Integer">
		<![CDATA[
		select count(*) 
		from board
		where user_id like '%'||#{search}||'%' or board_title like '%'||#{search}||'%'
		]]>
	</select>

	<!-- 게시글 작성 -->
	<insert id="writePost"
		parameterType="com.hiddenlayer.dalabel.board.Board">
		<![CDATA[
		insert into board(board_id, board_writer, board_category, board_title, board_content, board_delete, board_regist, board_edit)
		values(board_seq.nextval, #{board_writer}, #{board_category}, #{board_title}, #{board_content}, 0, sysdate, sysdate)
		]]>
	</insert>
	
	<!-- 게시글 수정 -->
	<insert id="writePost"
		parameterType="com.hiddenlayer.dalabel.board.Board">
		<![CDATA[
		insert into board(board_title, board_content, board_edit)
		values(#{board_title}, #{board_content}, sysdate)
		]]>
	</insert>

	<!-- 게시글 삭제 -->
	<delete id="deletePost"
		parameterType="java.math.BigDecimal">
		<![CDATA[
		delete from board where board_id = #{board_id}
		]]>
	</delete>

	<!-- 탈퇴 회원 게시글 -->
	<select id="getPostCountByUser"
		parameterType="com.hiddenlayer.dalabel.member.Member"
		resultType="java.lang.Integer">
		<![CDATA[
		select count(*) 
		from board
		where user_id = #{user_id}
		]]>
	</select>

	<!-- 댓글 작성 -->
	<insert id="writeComment"
		parameterType="com.hiddenlayer.dalabel.board.BoardComment">
		<![CDATA[
		insert into board(comment_id, comment_content, comment_delete, board_regist)
		values(comment_seq.nextval, #{comment_content}, 0, sysdate)
		]]>
	</insert>

	<!-- 댓글 조회 -->
	<select id="getComment"
		parameterType="com.hiddenlayer.dalabel.board.Board"
		resultType="com.hiddenlayer.dalabel.board.BoardComment">
		<![CDATA[
		select*
		from comment
		where board_id = #{board_id}
		order by comment_regist
		]]>
	</select>

</mapper>